# R2R MCP Server

R2R MCP Server предоставляет интеграцию Model Context Protocol (MCP) с системой R2R (Retrieval-to-Response) для улучшения взаимодействия с Claude и другими MCP-совместимыми моделями, обеспечивая доступ к базам знаний.

## Особенности

- MCP сервер для интеграции с Claude и другими MCP-совместимыми моделями
- Асинхронный клиент R2R для высокопроизводительного доступа к базам знаний
- Инструменты поиска и генерации ответов на основе контекстуальных данных
- Структурированное логирование с помощью Loguru
- Легкая архитектура с минимальными зависимостями

## Архитектура

Проект разработан в соответствии с принципами SOLID, DRY и KISS:

- **Single Responsibility**: Каждый компонент выполняет одну задачу
- **Open/Closed**: Модули открыты для расширения, но закрыты для модификации
- **Liskov Substitution**: Компоненты взаимозаменяемы через интерфейсы
- **Interface Segregation**: API разделены по функциональности
- **Dependency Inversion**: Зависимости внедряются, а не создаются внутри компонентов

## Структура проекта

```bash
r2r-mcp/
│
├── app/
│   └── server.py          # Основной MCP сервер
│
├── tests/                 # Тесты
│   └── ...
│
├── docs/                  # Документация
│   └── ...
│
├── logs/                  # Директория для логов
│   └── ...
│
├── .github/              # GitHub конфигурация
│   └── workflows/        # CI/CD workflows
│       ├── test.yml      # Тестирование
│       └── release.yml   # Релизы
│
├── .env.example          # Пример переменных окружения
├── Makefile              # Команды для разработки и тестирования
├── pyproject.toml        # Конфигурация проекта и зависимости
├── README.md             # Документация проекта
└── .gitignore            # Игнорируемые файлы Git
```

## Установка

### Предварительные требования

- Python 3.12 или выше
- uv (современный Python package manager)
- make (опционально, для использования Makefile)

### Установка зависимостей

#### С использованием Makefile (рекомендуется)

```bash
# Клонирование репозитория
git clone https://github.com/eagurin/r2r-mcp.git
cd r2r-mcp

# Создание виртуального окружения
uv venv
source .venv/bin/activate  # Linux/macOS
# или .venv\Scripts\activate  # Windows

# Установка основных зависимостей
make install

# Установка зависимостей для разработки
make install-dev
```

#### Вручную с помощью uv

```bash
# Установка uv, если не установлен
curl -LsSf https://astral.sh/uv/install.sh | sh

# Клонирование репозитория
git clone https://github.com/eagurin/r2r-mcp.git
cd r2r-mcp

# Создание виртуального окружения
uv venv
source .venv/bin/activate  # Linux/macOS
# или .venv\Scripts\activate  # Windows

# Установка основных зависимостей
uv pip install mcp r2r loguru

# Или установка через pyproject.toml
uv pip install .

# Установка с зависимостями для разработки
uv pip install ".[dev]"
```

### Установка как MCP-плагин

После установки зависимостей вы можете установить сервер как MCP-плагин:

```bash
# Локальный R2R API
mcp install app/server.py -v R2R_API_URL=https://api.sciphi.ai

# Облачный R2R API
mcp install app/server.py -v R2R_API_KEY=your_api_key_here
```

## Доступные инструменты MCP

| Инструмент | Описание |
|------------|----------|
| `search` | Поиск в документах с помощью R2R |
| `rag` | Получение ответа на основе базы знаний (RAG) |
| `web_search` | Поиск в интернете через R2R |
| `document_search` | Поиск в конкретном документе |
| `list_documents` | Список доступных документов |
| `agent_research` | Исследование через агента для сложных запросов |

## Использование с Claude

После установки как MCP-плагина, Claude автоматически получает доступ к инструментам R2R и может использовать их для:

1. Поиска информации в ваших документах
2. Ответов на вопросы с опорой на данные из базы знаний
3. Проведения исследования путем комбинирования разных источников информации

> Claude автоматически выберет соответствующий инструмент MCP и получит доступ к вашим данным через R2R API.

## Разработка

### Использование Makefile

Проект включает Makefile для удобного выполнения задач разработки:

### Показать список доступных команд

```bash
make help
```

### Запустить MCP сервер локально

```bash
make run
```

### Запуск тестов вручную

```bash
# Установка зависимостей для разработки
make install-dev

# Запуск тестов
make test

# Запуск с отчетом о покрытии
make test-cov
```

### Форматирование и проверка кода

```bash
# Форматирование кода и сортировка импортов
make format

# Проверка типов
make mypy

# Проверка стиля кода
make lint

# Запуск всех проверок и тестов
make all
```

## Contributing

Мы приветствуем вклад в развитие проекта! Чтобы внести свой вклад:

1. Форкните репозиторий
2. Создайте ветку для вашей функциональности (`git checkout -b feature/amazing-feature`)
3. Внесите изменения и отформатируйте код (`make format`)
4. Запустите проверки и тесты (`make all`)
5. Сделайте коммит (`git commit -m 'Add amazing feature'`)
6. Отправьте изменения (`git push origin feature/amazing-feature`)
7. Откройте Pull Request

Пожалуйста, убедитесь, что ваш код соответствует существующему стилю и проходит все тесты.

## Интеграция с другими MCP-совместимыми моделями

R2R MCP Server может работать с любыми MCP-совместимыми моделями, включая:

- Claude (через Claude.app или API)
- Другие LLM-модели с поддержкой MCP
- Кастомные клиенты MCP

## Зависимости проекта

Проект использует минимальный набор необходимых зависимостей, которые управляются через `pyproject.toml`:

- **mcp**: Model Context Protocol для интеграции с LLM
- **r2r**: Клиент для R2R API
- **loguru**: Структурированное логирование

Дополнительные зависимости для разработки (секция `[project.optional-dependencies]` в `pyproject.toml`):

- **pytest**, **pytest-asyncio**, **pytest-cov**: Для тестирования
- **black**, **isort**, **ruff**: Для форматирования и проверки кода
- **mypy**: Для проверки типов
- **httpx**: Для HTTP-клиента в тестах

## Лицензия

MIT
